<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KamaLama BITE - Результаты</title>

    <!-- Telegram Mini App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="styles/base.css">
</head>
<body>
    <main class="page">
        <div class="container">
            <section id="loading" class="card stack text-center loading-state">
                <div class="spinner" aria-hidden="true"></div>
                <h2>Анализируем ваши ответы...</h2>
                <p class="muted">Подготавливаем персональные рекомендации</p>
            </section>

            <section id="results" class="hidden stack-lg">
                <div class="card stack text-center">
                    <h2>Ваши результаты</h2>
                    <div class="result-number" id="life-expectancy">78</div>
                    <p class="muted">лет ожидаемой продолжительности жизни</p>
                </div>

                <div class="card recommendations">
                    <h3>Рекомендации для улучшения</h3>
                    <div id="recommendations-list" class="recommendation-list"></div>
                </div>

                <div class="navigation">
                    <button class="btn btn-primary" type="button" onclick="restartTest()">Пройти тест заново</button>
                    <button class="btn btn-secondary" type="button" onclick="shareResult()">Поделиться результатом</button>
                </div>
            </section>
        </div>
    </main>

    <script>
        // Инициализация Telegram WebApp
        const tg = window.Telegram?.WebApp;
        if (tg) {
            tg.ready();
            tg.expand();
        }

        function calculateResult() {
            const savedAnswers = localStorage.getItem('kamalama_answers');
            if (!savedAnswers) {
                window.location.href = 'welcome.html';
                return;
            }

            const answers = JSON.parse(savedAnswers);
            let baseAge = 75;
            let recommendations = [];

            if (answers.steps === '10001_more') {
                baseAge += 4;
                recommendations.push({
                    title: 'Отлично! Вы очень активны',
                    description: 'Высокая физическая активность значительно увеличивает продолжительность жизни'
                });
            } else if (answers.steps === '8001_10000') {
                baseAge += 3;
            } else if (answers.steps === '6001_8000') {
                baseAge += 2;
            } else if (answers.steps === '4001_6000') {
                baseAge += 1;
            } else if (answers.steps === '2201_4000') {
                baseAge -= 1;
                recommendations.push({
                    title: 'Увеличьте ежедневную активность',
                    description: 'Старайтесь делать больше шагов каждый день — цель 8000-10000 шагов'
                });
            } else if (answers.steps === 'less_2200') {
                baseAge -= 3;
                recommendations.push({
                    title: 'Критически важно увеличить активность',
                    description: 'Малоподвижный образ жизни серьезно сокращает продолжительность жизни'
                });
            }

            if (answers.activity === '5_more_times') {
                baseAge += 3;
            } else if (answers.activity === '3_4_times') {
                baseAge += 2;
            } else if (answers.activity === '1_2_times') {
                baseAge += 1;
            } else if (answers.activity === 'rarely_never') {
                baseAge -= 4;
                recommendations.push({
                    title: 'Начните заниматься спортом',
                    description: 'Регулярные тренировки увеличат продолжительность жизни и улучшат качество самочувствия'
                });
            }

            if (answers.sleep === '7_8' || answers.sleepHours === '7-8 часов') {
                baseAge += 2;
            } else if (answers.sleep === '5_6' || answers.sleepHours === '6-7 часов') {
                baseAge += 1;
            } else if (answers.sleep === 'more_8' || answers.sleepHours === 'Более 8 часов') {
                baseAge += 1;
            } else if (answers.sleep === 'less_5' || answers.sleepHours === 'Менее 6 часов') {
                baseAge -= 2;
                recommendations.push({
                    title: 'Наладьте режим сна',
                    description: 'Старайтесь спать 7-8 часов — это поддерживает гормональный баланс и иммунитет'
                });
            }

            if (answers.fastFood === 'Несколько раз в неделю' || answers.fastFood === 'Каждый день') {
                baseAge -= 2;
                recommendations.push({
                    title: 'Сократите фастфуд',
                    description: 'Частое употребление фастфуда негативно сказывается на здоровье сердца и сосудов'
                });
            } else if (answers.fastFood === 'Раз в неделю') {
                baseAge -= 1;
            }

            const resultElement = document.getElementById('life-expectancy');
            resultElement.textContent = baseAge;

            const recommendationsContainer = document.getElementById('recommendations-list');
            recommendationsContainer.innerHTML = '';

            if (recommendations.length === 0) {
                const successNote = document.createElement('div');
                successNote.className = 'recommendation';
                successNote.innerHTML = '<strong>Вы на правильном пути!</strong><br>Сохраняйте текущие привычки — это отличная база для долгой жизни.';
                recommendationsContainer.appendChild(successNote);
            } else {
                recommendations.forEach(item => {
                    const recommendationEl = document.createElement('div');
                    recommendationEl.className = 'recommendation';
                    recommendationEl.innerHTML = `<strong>${item.title}</strong><br>${item.description}`;
                    recommendationsContainer.appendChild(recommendationEl);
                });
            }

            document.getElementById('loading').classList.add('hidden');
            document.getElementById('results').classList.remove('hidden');
        }

        function restartTest() {
            localStorage.removeItem('kamalama_answers');
            window.location.href = 'welcome.html';
        }

        function shareResult() {
            if (tg) {
                tg.shareUrl('https://t.me/');
            } else {
                alert('Поделитесь результатом с друзьями!');
            }
        }

        setTimeout(calculateResult, 1200);
    </script>
</body>
</html>
